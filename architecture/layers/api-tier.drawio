<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="Architecture Template" version="22.0.0" type="device">
  <diagram name="API Tier" id="api-tier-detail">
    <mxGraphModel dx="1200" dy="700" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="700" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="API Tier - Component Details" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="400" height="30" as="geometry" />
        </mxCell>

        <!-- Main Container -->
        <mxCell id="api-container" value="API TIER" style="swimlane;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;fontStyle=1;startSize=30;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="60" width="1000" height="580" as="geometry" />
        </mxCell>

        <!-- External Traffic -->
        <mxCell id="ext-traffic" value="External Traffic&#xa;(HTTPS)" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;fillColor=#fed7aa;strokeColor=#f97316;" vertex="1" parent="api-container">
          <mxGeometry x="420" y="40" width="160" height="50" as="geometry" />
        </mxCell>

        <!-- Load Balancer Section -->
        <mxCell id="lb-section" value="Load Balancing Layer" style="swimlane;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;startSize=25;" vertex="1" parent="api-container">
          <mxGeometry x="20" y="110" width="960" height="120" as="geometry" />
        </mxCell>

        <mxCell id="lb1" value="Load Balancer 1&#xa;(HAProxy)&#xa;Active" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="lb-section">
          <mxGeometry x="280" y="35" width="120" height="70" as="geometry" />
        </mxCell>

        <mxCell id="lb2" value="Load Balancer 2&#xa;(HAProxy)&#xa;Standby" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="lb-section">
          <mxGeometry x="560" y="35" width="120" height="70" as="geometry" />
        </mxCell>

        <mxCell id="vip" value="Virtual IP&#xa;(Keepalived)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="lb-section">
          <mxGeometry x="420" y="30" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="ssl" value="SSL/TLS&#xa;Termination" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="lb-section">
          <mxGeometry x="40" y="45" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="healthcheck" value="Health&#xa;Checks" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="lb-section">
          <mxGeometry x="820" y="45" width="100" height="50" as="geometry" />
        </mxCell>

        <!-- API Gateway Section -->
        <mxCell id="gw-section" value="API Gateway Layer" style="swimlane;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;startSize=25;" vertex="1" parent="api-container">
          <mxGeometry x="20" y="250" width="960" height="130" as="geometry" />
        </mxCell>

        <mxCell id="gw1" value="API Gateway 1&#xa;(Kong/Express)&#xa;Routes + Plugins" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="gw-section">
          <mxGeometry x="80" y="35" width="140" height="70" as="geometry" />
        </mxCell>

        <mxCell id="gw2" value="API Gateway 2&#xa;(Kong/Express)&#xa;Routes + Plugins" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="gw-section">
          <mxGeometry x="280" y="35" width="140" height="70" as="geometry" />
        </mxCell>

        <mxCell id="gw3" value="API Gateway 3&#xa;(Kong/Express)&#xa;Routes + Plugins" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="gw-section">
          <mxGeometry x="480" y="35" width="140" height="70" as="geometry" />
        </mxCell>

        <mxCell id="gw4" value="API Gateway 4&#xa;(Kong/Express)&#xa;Routes + Plugins" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="gw-section">
          <mxGeometry x="680" y="35" width="140" height="70" as="geometry" />
        </mxCell>

        <!-- Auth Section -->
        <mxCell id="auth-section" value="Authentication &amp; Authorization" style="swimlane;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;startSize=25;" vertex="1" parent="api-container">
          <mxGeometry x="20" y="400" width="460" height="150" as="geometry" />
        </mxCell>

        <mxCell id="auth-svc" value="Auth Service&#xa;(OAuth 2.0 / OIDC)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="auth-section">
          <mxGeometry x="30" y="40" width="130" height="60" as="geometry" />
        </mxCell>

        <mxCell id="jwt" value="JWT Validation&#xa;(RS256)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="auth-section">
          <mxGeometry x="180" y="40" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="rbac" value="RBAC Engine&#xa;(Permissions)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="auth-section">
          <mxGeometry x="300" y="40" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="auth-cache" value="Auth Cache (Redis)&#xa;Session + Token Store" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#fef3c7;strokeColor=#f59e0b;" vertex="1" parent="auth-section">
          <mxGeometry x="165" y="110" width="130" height="35" as="geometry" />
        </mxCell>

        <!-- Rate Limiting Section -->
        <mxCell id="rate-section" value="Rate Limiting &amp; Protection" style="swimlane;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;startSize=25;" vertex="1" parent="api-container">
          <mxGeometry x="500" y="400" width="480" height="150" as="geometry" />
        </mxCell>

        <mxCell id="rate-limiter" value="Rate Limiter&#xa;(Token Bucket)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="rate-section">
          <mxGeometry x="30" y="40" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="throttle" value="Throttling&#xa;(Per User/IP)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="rate-section">
          <mxGeometry x="150" y="40" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="waf" value="WAF&#xa;(ModSecurity)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#3b82f6;" vertex="1" parent="rate-section">
          <mxGeometry x="270" y="40" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="ddos" value="DDoS Protection&#xa;(Cloudflare/AWS)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fed7aa;strokeColor=#f97316;" vertex="1" parent="rate-section">
          <mxGeometry x="390" y="40" width="80" height="60" as="geometry" />
        </mxCell>

        <mxCell id="rate-cache" value="Rate Counter Cache (Redis)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#fef3c7;strokeColor=#f59e0b;" vertex="1" parent="rate-section">
          <mxGeometry x="115" y="110" width="150" height="35" as="geometry" />
        </mxCell>

        <!-- Flow Arrows -->
        <mxCell id="flow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#374151;strokeWidth=2;" edge="1" parent="api-container" source="ext-traffic" target="lb-section">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#374151;strokeWidth=2;" edge="1" parent="api-container" source="lb-section" target="gw-section">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#374151;strokeWidth=2;" edge="1" parent="api-container" source="gw-section" target="auth-section">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#374151;strokeWidth=2;" edge="1" parent="api-container" source="gw-section" target="rate-section">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- To Business Tier -->
        <mxCell id="to-business" value="To Business Tier" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;fillColor=#e9d5ff;strokeColor=#8b5cf6;" vertex="1" parent="1">
          <mxGeometry x="420" y="660" width="160" height="40" as="geometry" />
        </mxCell>

        <mxCell id="flow-out" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#374151;strokeWidth=2;" edge="1" parent="1" source="api-container" target="to-business">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
